<!doctype html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" href="/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/css/cart.css">
    <link rel="stylesheet" href="/css/nav.css">
    <title>Cart</title>
</head>
<body>
    <div th:replace="include/nav :: navbar"></div>

    <div class="cart-container">
        <h1 class="cart-title">장바구니</h1>

        <div class="cart-item-container">
            <h3>장바구니 상품</h3>

            <div class="cart-item" th:each="cartList : ${cartList}">

                <!-- 체크박스 -->
                <input type="checkbox" class="cart-item-checkbox">

                <!-- 상품 이미지 -->
                <img th:src="@{/img/product_img/{img1}(img1=${cartList.img})}" alt="상품 이미지" class="cart-item-image">

                <div class="cart-item-details">
                    <p class="cart-item-title" th:text="${cartList.product_name}">상품이름</p>
                    <p class="cart-item-title" th:text="${cartList.design}">디자인이름</p>
                    <p class="cart-item-price" th:text="${cartList.price}" id="price">상품가격</p>
                </div>

                <div class="cart-item-quantity">
                    <span class="mb-5">수량</span>
                    <div class="quantity-controls">
                        <button class="minus" id="minus">-</button>
                        <input type="text" th:value="${cartList.amount}" id="amount" class="quantity-input">
                        <button class="plus" id="plus">+</button>
                        <button class="update" id="update">변경</button>
                    </div>
                </div>

                <div class="cart-item-total">
                    <p id="item_price">상품가격 * 수량</p>
                </div>

                <!-- 삭제 버튼 -->
                <button class="delete-btn">x</button>
            </div>
        </div>

        <div class="cart-summary">
            <div class="summary-item">
                <span>총 상품금액</span>
                <span>7,500원</span>
            </div>
            <div class="summary-item">
                <span>총 배송비</span>
                <span>2,500원</span>
            </div>
            <div class="summary-total">
                <span>결제예정금액</span>
                <span>10,000원</span>
            </div>
        </div>

        <div class="cart-buttons">
            <button class="order-all">전체상품주문</button>
            <button class="order-selected">선택상품주문</button>
        </div>
    </div>

    <script>
        'use strict'

        const minus = document.getElementById('minus');
        const plus = document.getElementById('plus');
        const update = document.getElementById('update');

        let item_price = document.getElementById('item_price').textContent;
        const price = parseInt(document.getElementById('price').textContent.trim());
        let amount = parseInt(document.getElementById('amount').value.trim());
        item_price_view();

        minus.addEventListener('click', function(event) {
            if(amount == 1){
                alert('수량을 1개 미만으로 설정할 수 없습니다.');
                return;
            }
            else amount = amount - 1;
            document.getElementById('amount').value = amount;

            item_price_view();
        })

        plus.addEventListener('click', function(event) {

            // 현재 상품의 남아있는 수량을 체크해서 그 이상 숫자가 커질 수 없게 막아야한다.

            amount = amount + 1;
            document.getElementById('amount').value = amount;

            item_price_view();
        })

        function item_price_view(){
            if (!isNaN(price) && !isNaN(amount)) {
                item_price = price * amount;
                document.getElementById('item_price').textContent = item_price.toLocaleString() + ' 원';
            }
        }

    </script>
</body>
</html>